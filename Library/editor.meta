this=map.Merge
	parent
	logic
	map
	math
	System
	System.IO
	System.Windows.Forms
	System.Drawing
choose=
	OpenFile=!
		dialog=OpenFileDialog""
		dialog.ShowDialog""
		this=dialog.FileName
	SaveFile=!
		dialog=SaveFileDialog""
		dialog.ShowDialog""
		this=dialog.FileName
file=
	Write=!
		writer=StreamWriter arg.1
		writer.Write arg.2
		writer.Close""
	Read=!
		reader=StreamReader arg
		result=reader.ReadToEnd""
		reader.Close""
		this=result
fileName=""
commands=
	SaveAs=!
		saveAs=choose.SaveFile""
		If
			Not Equal
				saveAs
				""
			then=!
				fileName:saveAs
				file.Write
					fileName
					editBox.dotNet.RealText
	Save=!If
		Equal
			fileName
			""
		then=!commands.SaveAs""
		else=!file.Write
			fileName
			editBox.dotNet.RealText
	OpenFile=!
		openFileName=choose.OpenFile""
		If
			Not Equal
				openFileName
				""
			then=!
				fileName:openFileName
				editBox.dotNet.RealText:file.Read fileName
keyBindings=
	[Keys.Escape]=!editBox.dotNet.StopInteractiveSearch""
	[Keys.Alt]=
		[Keys.K]=!editBox.dotNet.MoveLineDown""
		[Keys.L]=!editBox.dotNet.MoveLineUp""
		[Keys.Oemtilde]=!editBox.dotNet.MoveCharRight""
		[Keys.J]=!editBox.dotNet.MoveCharLeft""
	[bitwise.Or
		Keys.Alt
		Keys.Control
	]=
		[Keys.J]=!editBox.dotNet.MoveWordLeft""
		[Keys.Oemtilde]=!editBox.dotNet.MoveWordRight""
	[bitwise.Or
		Keys.Alt
		Keys.Control
		Keys.Shift
	]=
		[Keys.J]=!editBox.dotNet.SelectWordLeft""
		[Keys.Oemtilde]=!editBox.dotNet.SelectWordRight""
		[Keys.K]=!editBox.dotNet.SelectLineUp""
		[Keys.J]=!editBox.dotNet.SelectLineDown""
	[Keys.F5]=!RunProgram""
	[Keys.Control]=
		[Keys.S]=!commands.Save""
		[Keys.I]=!editBox.dotNet.StartInteractiveSearch""
		[Keys.F]=!editBox.dotNet.FindAndReplace""
RunProgram=!
	commands.Save""
	Meta.Expression.BreakPoint:Meta.BreakPoint
		fileName
		Meta.Position
			editBox.dotNet.RealLine
			editBox.dotNet.Column
	Meta.Interpreter.DebugBreak:!editBox.dotNet.ShowDebugValue Meta.Interpreter.DebugValue
	Meta.Interpreter.StartDebug fileName
ContinueProgram=!
	// factor out the setting of the breakpoint
	System.Console.WriteLine editBox.dotNet.RealLine
	System.Console.WriteLine editBox.dotNet.Column
	Meta.Expression.BreakPoint:Meta.BreakPoint
		fileName
		Meta.Position
			editBox.dotNet.RealLine
			editBox.dotNet.Column
	Meta.Interpreter.ContinueDebug""
ReverseProgram=!
	// factor out the setting of the breakpoint
	System.Console.WriteLine editBox.dotNet.RealLine
	System.Console.WriteLine editBox.dotNet.Column
	Meta.Expression.BreakPoint:Meta.BreakPoint
		fileName
		Meta.Position
			editBox.dotNet.RealLine
			editBox.dotNet.Column
	Meta.Interpreter.ReverseDebug""
EditBox=!
	dotNet=Init
		ScrollingTextBox""
		=
			ShowSelectionMargin="1"
			AcceptsTab="1"
			Dock=DockStyle.Fill
			ScrollBars=RichTextBoxScrollBars.ForcedBoth
			KeyDown=!
				e=arg.2
				// maybe this should be the other way round ???
				If
					ContainsKey
						keyBindings
						e.Modifiers
					then=!
						subKey=keyBindings.[e.Modifiers]
						If
							ContainsKey
								subKey
								e.KeyCode
							then=!
								subKey.[e.KeyCode]""
					else=!
						If
							ContainsKey
								keyBindings
								e.KeyCode
							then=!keyBindings.[e.KeyCode]""
	SetText=!
		dotNet.Text:arg
editBox=EditBox""
form=
	form=Form""
	form.Text="Meta Edit"
	form.Font=Font
		"Courier New"
		"10"
	//form.Controls.Add
	//	editBox
	form.WindowState=FormWindowState.Maximized
	menu=
		File=
			["Open..."]=commands.OpenFile
			["Save"]=commands.Save
			["Save as..."]=commands.SaveAs
			["Close"]=!form.Close""
		Program=
			Start=RunProgram
			Continue=ContinueProgram
			Reverse=ReverseProgram
	form.Menu=MainMenu Apply
		!MenuItem 
			arg.key
			Apply
				!MenuItem
					arg.key
					arg.value
				arg.value
		menu
	this=form
form.ShowDialog""