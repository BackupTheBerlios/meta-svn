|
	current=library.map.merge
		System
		System.IO
		System.Windows.Forms
		System.Drawing
		parent
		library.boolean
		library.map
		library.number
		array
		Meta
	choose=
		OpenFile=
			|
				dialog=OpenFileDialog*
				dialog.ShowDialog*
				current=dialog.FileName.get*
		SaveFile=
			|
				dialog=SaveFileDialog*
				dialog.ShowDialog*
				current=dialog.FileName.get*
	file=
		Write=
			|
				writer=StreamWriter
					parameter.[1]
				writer.Write
					parameter.[2]
				writer.Close*
		Read=
			|
				reader=StreamReader
					parameter
				result=reader.ReadToEnd*
				reader.Close*
				current=result
	fileName=*
	SetFileName=
		|
			parent.parent.fileName=parameter
			form.Text.set
				Concatenation
					"Meta Edit - "
					fileName
	SetBreakPoint=
		|Meta.Interpreter.BreakPoint.set
			Meta.BreakPoint
				fileName
				Meta.SourcePosition
					add
						editBox.LineIndex.get*
						1
					editBox.Column.get*
	commands=
		SaveAs=
			|
				saveAs=choose.SaveFile*
				hasName=not equal
					saveAs
					*
				cases=
					[*]=
						|*
					[1]=
						|
							SetFileName saveAs
							file.Write
								fileName
								editBox.RealText.get*
				cases.[hasName]*
		Save=
			|
				hasName=not Equality
					fileName
					*
				cases=
					[*]=
						|commands.SaveAs*
					[1]=
						|file.Write
							fileName
							editBox.RealText.get*
				cases.[hasName]*
		Open=
			|
				openFileName=choose.OpenFile*
				hasName=not Equality
					openFileName
					*
				cases=
					[*]=
						|*
					[1]=
						|
							SetFileName openFileName
							editBox.RealText.set
								file.Read fileName
							editBox.MoveAbsolute
								*
								*
				cases.[hasName]*
		Run=
			|
				commands.Save*
				SetBreakPoint*
				Meta.Interpreter.Break.add
					=
						|editBox.ShowDebugValue
							parameter.[1]
				Meta.Interpreter.StartDebug
					fileName
		Continue=
			|
				SetBreakPoint*
				Meta.Interpreter.ContinueDebug*
		Reverse=
			|
				SetBreakPoint*
				Meta.Interpreter.ReverseDebug*
		Stop=
			|Meta.Interpreter.StopDebug*
	CombinedModifierKeys=
		current=System.Windows.Forms
		AltControl=library.bitwise.or
			Keys.Alt
			Keys.Control
		AltShift=library.bitwise.or
			Keys.Alt
			Keys.Shift
		AltControlShift=library.bitwise.or
			Keys.Alt
			Keys.Control
			Keys.Shift
		ControlShift=library.bitwise.or
			Keys.Control
			Keys.Shift
	shortcutCombinations=
		current=System.Windows.Forms
		[Keys.None]=
			[Keys.Escape]=
				|editBox.StopInteractiveSearch*
			[Keys.F5]=
				|commands.Run*
			[Keys.F5]=
				|commands.Run*
			[Keys.Up]=
				|editBox.MoveLineUp*
			[Keys.Down]=
				|editBox.MoveLineDown*
			[Keys.Left]=
				|editBox.MoveCharLeft*
			[Keys.Right]=
				|editBox.MoveCharRight*
			[Keys.Home]=
				|editBox.MoveLineStart*
			[Keys.End]=
				|editBox.MoveLineEnd*
			[Keys.Tab]=
				|editBox.IncreaseSelectionIndent*
			[Keys.Back]=
				|editBox.DeleteCharLeft*
			[Keys.Delete]=
				|editBox.DeleteCharRight*
			[Keys.PageUp]=
				|editBox.MovePageUp*
			[Keys.PageDown]=
				|editBox.MovePageDown*
		[Keys.Shift]=
			[Keys.Left]=
				|editBox.SelectCharLeft*
			[Keys.Right]=
				|editBox.SelectCharRight*
		[Keys.Control]=
			[Keys.O]=
				|commands.Open*
			[Keys.S]=
				|commands.Save*
			[Keys.I]=
				|editBox.StartInteractiveSearch*
			[Keys.H]=
				|editBox.FindAndReplace*
			[Keys.Left]=
				|editBox.MoveWordLeft*
			[Keys.Right]=
				|editBox.MoveWordRight*
			[Keys.Back]=
				|editBox.DeleteWordLeft*
			[Keys.Delete]=
				|editBox.DeleteWordRight*
			[Keys.Home]=
				|editBox.MoveDocumentStart*
			[Keys.End]=
				|editBox.MoveDocumentEnd*
		[Keys.Alt]=
			[Keys.K]=
				|editBox.MoveLineDown*
			[Keys.L]=
				|editBox.MoveLineUp*
			[Keys.Oemtilde]=
				|editBox.MoveCharRight*
			[Keys.J]=
				|editBox.MoveCharLeft*
			[Keys.U]=
				|editBox.MoveLineStart*
			[Keys.OemSemicolon]=
				|editBox.MoveLineEnd*
			[Keys.N]=
				|editBox.DeleteCharLeft*
			[Keys.M]=
				|editBox.DeleteCharRight*
		[CombinedModifierKeys.ControlShift]=
			[Keys.Left]=
				|editBox.SelectWordLeft*
			[Keys.Right]=
				|editBox.SelectWordRight*
		[CombinedModifierKeys.AltShift]=
			[Keys.J]=
				|editBox.SelectCharLeft*
			[Keys.Oemtilde]=
				|editBox.SelectCharRight*
			[Keys.L]=
				|editBox.SelectLineUp*
			[Keys.K]=
				|editBox.SelectLineDown*
			[Keys.OemSemicolon]=
				|editBox.SelectLineEnd*
			[Keys.U]=
				|editBox.SelectLineStart*
		[CombinedModifierKeys.AltControl]=
			[Keys.J]=
				|editBox.MoveWordLeft*
			[Keys.Oemtilde]=
				|editBox.MoveWordRight*
			[Keys.OemSemicolon]=
				|editBox.MoveDocumentEnd*
			[Keys.U]=
				|editBox.MoveDocumentStart*
			[Keys.N]=
				|editBox.DeleteWordLeft*
			[Keys.M]=
				|editBox.DeleteWordRight*
			[Keys.L]=
				|editBox.MovePageUp*
			[Keys.K]=
				|editBox.MovePageDown*
		[CombinedModifierKeys.AltControlShift]=
			[Keys.J]=
				|editBox.SelectWordLeft*
			[Keys.Oemtilde]=
				|editBox.SelectWordRight*
	editBox=
		editBox=ScrollingTextBox*
		editBox.ShowSelectionMargin.set
			1
		editBox.AcceptsTab.set
			1
		editBox.Dock.set
			DockStyle.Fill
		editBox.ScrollBars.set
			RichTextBoxScrollBars.ForcedBoth
		editBox.Moved.add
			=
				|
					cases=
						[*]=
							|commands.Reverse*
						[1]=
							|commands.Continue*
					breakpoint=Meta.Interpreter.BreakPoint.get*
					position=breakpoint.Position.get*
					line=position.Line.get*
					forward=smaller
						line
						editBox.LineIndex.get*
					cases.[forward]*
#editBox.Changed.add
#	=
#		|editBox.*
		editBox.KeyDown.add
			=
				|
					eventArgs=parameter.[2]
					modifier=eventArgs.Modifiers.get*
					key=eventArgs.KeyCode.get*
					shortcuts=shortcutCombinations.[modifier]
					exists=Containment
						map=shortcuts
						key=key
					cases=
						[1]=
							|
								editBox.SuspendWindowUpdate*
								shortcuts.[key]*
								editBox.ResumeWindowUpdate*
								eventArgs.Handled.set
									1
						[*]=
							|*
					cases.[exists]*
		current=editBox
	form=
		form=Form*
		form.Text.set
			"Meta Edit"
		form.Font.set
			Font
				"Courier New"
				10
		controls=form.Controls.get*
		controls.AddRange
			=
				editBox
#form.WindowState.set
#	FormWindowState.Maximized
		menu=
			File=
				["Open..."]=commands.Open
				["Save"]=commands.Save
				["Save as..."]=commands.SaveAs
				["Close"]=
					|form.Close*
			Debug=
				Start=commands.Run
				Continue=commands.Continue
				Reverse=commands.Reverse
				Stop=commands.Stop
		form.Menu.set
			MainMenu
				apply
					array=keys menu
					function=
						|
							topKey=parameter
							current=MenuItem
								topKey
								apply
									array=keys menu.[topKey]
									function=
										|MenuItem
											parameter
											menu.[topKey].[parameter]
		current=form
	form.ShowDialog*