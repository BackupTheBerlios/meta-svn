integer "0123456789"
syntax
	string '"'
text|
	number rule
		condition
			text|
				matched apply
					array text
					condition
						char|contains
							array integer
							value char
					function
						arg|arg
				current if
					condition not equal
						. matched
						. 0
					then
						|
							result matched
							rest slice
								array text
								start add
									. length matched
									. 1
		result
			text|/.Meta.Number.Parse text
	character
		char|rule
			condition
				text|if
					condition not zero text
					then
						|if
							condition not equal
								. first text
								. char
							then
								|
									result first text
									rest slice
										array text
										start 2
			result
				char|char
	stringCharacter character syntax.string
	stringTest zeroOrMore stringCharacter
	string rule
		condition
			text|
				. print text
				current if
					condition 1
					then
						|
							result text
							rest slice
								array text
								start add
									. length text
									. 1
		result
			text|text
	expression sequence
		. number
		. string
	parsed stringTest "
		12344321 asdfasdf 
	"
	current parsed.result
zeroOrMore
	documentation "Matches a rule zero or more times"
	rule|
		text|
			rest text
			result while
				condition
					|not zero rule rest
				function
					|
						ruleResult rule rest
						$rest ruleResult.rest
						current ruleResult.result
sequence
	documentation "Returns the concatenated results of all rules in 'result', if all rules matched, or nothing."
	rules|
		text|
			matched 0
			rest text
			applied apply
				array rules
				function
					rule|
						ruleResult rule rest
						. print ruleResult
						. if
							condition hasKey
								map ruleResult
								key "result"
							then
								|
									$rest ruleResult.rest
									$matched join
										. matched
										.
											. ruleResult.result
			result if
				condition equal
					. length applied
					. length rules
				then
					|
						result matched

prePost
	documentation "Matches a rule and throws away the results of a preceding and a following rule."
	arg|
		text|
			preResult arg.pre text
			. if
				condition not zero preResult
				then
					|
						ruleResult arg.rule preResult.rest
						. if
							condition not zero ruleResult
							then
								|
									postResult arg.post ruleResult.rest
									. if
										condition not zero postResult
										then
											|
												result ruleResult
												rest postResult.rest
alternatives
	documentation "Returns the result of the first rule that matched in 'result', or nothing."
	alts|
		text|
			result 0
			. apply
				array alts
				condition
					alt|
						applied alt text
						current if
							condition not zero applied
							then
								|
									$result applied.result
									current 0
							else
								|1
				function
					|0
rule
	documentation "A rule returns the result in 'result' or nothing, if the rule did not match."
	arg|
		text|
			map arg.condition text
			stuff if
				condition hasKey
					map map
					key "result"
				then
					|
						result arg.result map.result
						rest map.rest
			. print stuff
			current stuff